---
phase: 02-charting-core
plan: 05
type: execute
wave: 3
depends_on: [02-01, 02-02, 02-04]
files_modified:
  - frontend/src/stores/watchlist-store.ts
  - frontend/src/components/watchlist/watchlist-panel.tsx
  - frontend/src/components/watchlist/watchlist-item.tsx
  - frontend/src/components/watchlist/symbol-search.tsx
  - frontend/src/components/layout/left-sidebar.tsx
autonomous: true
requirements: [CHART-09, CHART-10]

must_haves:
  truths:
    - "User can see their watchlist with symbol names, last prices, and 24h percentage changes in the left sidebar"
    - "User can search for crypto symbols and add them to their watchlist"
    - "User can click a symbol in the watchlist to switch the chart to that symbol"
    - "User can remove symbols from their watchlist"
    - "Watchlist data persists across page refreshes via backend API"
    - "Active symbol in watchlist is visually highlighted"
  artifacts:
    - path: "frontend/src/stores/watchlist-store.ts"
      provides: "Zustand store syncing watchlist state with backend API"
      min_lines: 60
    - path: "frontend/src/components/watchlist/watchlist-panel.tsx"
      provides: "Watchlist container rendered in left sidebar"
      min_lines: 60
    - path: "frontend/src/components/watchlist/watchlist-item.tsx"
      provides: "Single watchlist row with symbol, price, change percentage"
      min_lines: 40
    - path: "frontend/src/components/watchlist/symbol-search.tsx"
      provides: "Search bar to find and add symbols"
      min_lines: 50
    - path: "frontend/src/components/layout/left-sidebar.tsx"
      provides: "Updated left sidebar integrating watchlist panel below navigation"
      min_lines: 60
  key_links:
    - from: "frontend/src/stores/watchlist-store.ts"
      to: "frontend/src/lib/api.ts"
      via: "fetches watchlists from backend via apiGet/apiPost/apiDelete"
      pattern: "apiGet.*watchlists"
    - from: "frontend/src/components/watchlist/watchlist-panel.tsx"
      to: "frontend/src/stores/watchlist-store.ts"
      via: "reads watchlist items and calls add/remove actions"
      pattern: "useWatchlistStore"
    - from: "frontend/src/components/watchlist/watchlist-item.tsx"
      to: "frontend/src/stores/chart-store.ts"
      via: "calls setSymbol on click to switch chart"
      pattern: "useChartStore.*setSymbol"
    - from: "frontend/src/components/layout/left-sidebar.tsx"
      to: "frontend/src/components/watchlist/watchlist-panel.tsx"
      via: "renders WatchlistPanel below navigation items"
      pattern: "WatchlistPanel"
---

<objective>
Build the watchlist frontend: Zustand store with backend sync, watchlist panel, individual watchlist items, symbol search, and integrate into the left sidebar. Wire symbol switching to the chart.

Purpose: Users need to manage their tracked instruments and quickly switch between symbols. This plan connects the watchlist backend (Plan 04) to the chart (Plan 02) through a searchable, interactive panel in the left sidebar -- completing the symbol discovery and management workflow.

Output: Functional watchlist in the left sidebar with search, add/remove symbols, click-to-switch-chart, and backend persistence.
</objective>

<execution_context>
@/Users/heispv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/heispv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-charting-core/02-RESEARCH.md
@.planning/phases/02-charting-core/02-CONTEXT.md
@.planning/phases/02-charting-core/02-01-SUMMARY.md
@.planning/phases/02-charting-core/02-02-SUMMARY.md
@.planning/phases/02-charting-core/02-04-SUMMARY.md
@frontend/src/components/layout/left-sidebar.tsx
@frontend/src/stores/ui-store.ts
@frontend/src/stores/user-store.ts
@frontend/src/lib/api.ts
@frontend/src/types/chart.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create watchlist store and watchlist components</name>
  <files>
    frontend/src/stores/watchlist-store.ts
    frontend/src/components/watchlist/watchlist-panel.tsx
    frontend/src/components/watchlist/watchlist-item.tsx
    frontend/src/components/watchlist/symbol-search.tsx
  </files>
  <action>
1. Create `frontend/src/stores/watchlist-store.ts`:
   - Follow the pattern from user-store.ts (Zustand with API sync, NOT localStorage persist -- data lives on backend)
   - State:
     - `watchlists`: array of watchlist objects (id, name, items[])
     - `activeWatchlistId`: string | null (selected watchlist)
     - `isLoading`: boolean
     - `error`: string | null
   - Actions:
     - `fetchWatchlists()`: GET /api/v1/watchlists → sets watchlists. Sets activeWatchlistId to first watchlist if not set. Called on mount.
     - `addSymbol(symbol: string)`: POST /api/v1/watchlists/{activeWatchlistId}/items with {symbol}. Optimistic update: add immediately, rollback on error.
     - `removeSymbol(symbol: string)`: DELETE /api/v1/watchlists/{activeWatchlistId}/items/{symbol}. Optimistic update: remove immediately, rollback on error.
     - `setActiveWatchlist(id: string)`: sets activeWatchlistId
   - Import apiGet, apiPost, apiDelete from lib/api.ts
   - Active watchlist items derived from state: `getActiveItems()` = watchlists.find(w => w.id === activeWatchlistId)?.items ?? []

2. Create `frontend/src/components/watchlist/watchlist-item.tsx` (`"use client"`):
   - Props: `{ symbol: string; isActive: boolean; onSelect: () => void; onRemove: () => void }`
   - Layout: horizontal row, compact height (~36-40px), padding horizontal 8-12px
   - Left side: Symbol name (e.g., "BTC/USDT" -- format by inserting "/" before "USDT")
   - Right side: Last price and 24h change percentage
   - Since we have mock data (no real-time prices), derive "last price" and "24h change" from the mock data generator:
     - Import getMockDataForSymbol from lib/mock-data.ts
     - Get the last candle's close price and calculate % change from the 24h-ago candle
     - Memoize with useMemo to avoid recalculating on every render
   - Price color: neutral/white for price, green for positive % change, red for negative
   - Active state (isActive): highlighted background (subtle accent tint)
   - Hover state: slightly lighter background
   - Remove button: small X icon on hover (only visible on hover), positioned far right
   - Click on the row (except X) calls onSelect
   - Click on X calls onRemove

3. Create `frontend/src/components/watchlist/symbol-search.tsx` (`"use client"`):
   - Search bar at the top of the watchlist panel
   - Input field: compact, placeholder "Search symbols...", search icon (lucide Search)
   - Import CRYPTO_SYMBOLS from types/chart.ts
   - Filter CRYPTO_SYMBOLS by search query (match against symbol and name fields, case-insensitive)
   - Show filtered results in a dropdown below the input (Radix Popover or simple absolute-positioned div)
   - Each result item shows: symbol (e.g., "BTCUSDT") and name (e.g., "Bitcoin")
   - Clicking a result:
     1. Adds symbol to the active watchlist via watchlist store addSymbol()
     2. Switches the chart to that symbol via chart store setSymbol()
     3. Clears the search input and closes dropdown
   - Show a "+" button or visual indicator for adding
   - If symbol is already in watchlist, show a checkmark instead of "+" (already added)
   - Empty state: "No matching symbols" when no results match

4. Create `frontend/src/components/watchlist/watchlist-panel.tsx` (`"use client"`):
   - Container for the entire watchlist section in the left sidebar
   - Renders:
     - `<SymbolSearch />` at the top
     - Separator/divider
     - Scrollable list of `<WatchlistItem />` components
     - Loading spinner while fetchWatchlists is in progress
     - Empty state: "No symbols in watchlist. Search to add." when list is empty
   - On mount: calls `useWatchlistStore().fetchWatchlists()` via useEffect
   - Maps over active watchlist items, passing:
     - `isActive`: compares item.symbol with chart store's activeSymbol
     - `onSelect`: calls `useChartStore().setSymbol(item.symbol)`
     - `onRemove`: calls `useWatchlistStore().removeSymbol(item.symbol)`
   - Title/header: "Watchlist" with a subtle label
   - When left sidebar is collapsed, hide the watchlist panel entirely (check useUIStore().leftSidebarCollapsed)
  </action>
  <verify>
    - `npx tsc --noEmit --project frontend/tsconfig.json` passes
    - All 4 files exist under frontend/src/
    - watchlist-store.ts exports useWatchlistStore
    - Components render without errors
    - Symbol search filters CRYPTO_SYMBOLS correctly
    - WatchlistItem displays formatted symbol, price, change %
  </verify>
  <done>Watchlist store syncs with backend API, watchlist panel shows symbols with prices, search filters and adds symbols, items are clickable to switch chart, removable with X button</done>
</task>

<task type="auto">
  <name>Task 2: Integrate watchlist panel into left sidebar and wire symbol switching</name>
  <files>
    frontend/src/components/layout/left-sidebar.tsx
  </files>
  <action>
1. Update `frontend/src/components/layout/left-sidebar.tsx`:
   - Keep existing navigation items (Dashboard, Chart, Journal, Analytics) at the top
   - Update the Chart nav item: change href from "#" to "/" and remove `disabled: true` (chart is now on the dashboard page)
   - Add a horizontal separator (border-t) below the navigation section
   - Below the separator, render `<WatchlistPanel />` in a flex-1 overflow-y-auto container
   - The watchlist panel should fill the remaining vertical space below nav items
   - When sidebar is collapsed (leftSidebarCollapsed): hide the watchlist panel (it needs width for text)
   - Layout structure:
     ```
     <div className="flex h-full flex-col">
       <nav>
         {/* existing nav items */}
       </nav>
       <div className="border-t border-border" />
       {!leftSidebarCollapsed && (
         <div className="flex-1 overflow-y-auto">
           <WatchlistPanel />
         </div>
       )}
       <div className="border-t border-border p-2">
         {/* existing collapse toggle button */}
       </div>
     </div>
     ```
   - Import WatchlistPanel from components/watchlist/watchlist-panel

2. Verify the full flow works end-to-end:
   - User logs in → sees dashboard with chart (BTC/USDT default)
   - Left sidebar shows nav items + watchlist below
   - Watchlist loads from backend (auto-creates default with BTC, ETH, SOL, BNB)
   - BTC/USDT is highlighted as active in watchlist
   - User clicks ETH/USDT in watchlist → chart switches to ETH data, ETH becomes highlighted
   - User searches "DOG" → DOGE/USDT appears → click adds to watchlist AND switches chart
   - User hovers over DOGE in watchlist → X appears → click removes it
   - Collapsing left sidebar hides watchlist, expanding shows it again
   - Refreshing page: watchlist still shows same symbols (backend persistence)
  </action>
  <verify>
    - `npx tsc --noEmit --project frontend/tsconfig.json` passes
    - Navigate to dashboard: left sidebar shows nav items + watchlist
    - Clicking a watchlist symbol switches the chart
    - Active symbol is highlighted in watchlist
    - Symbol search works and adds to watchlist
    - Removing a symbol from watchlist works
    - Sidebar collapse hides watchlist, expand shows it
    - Page refresh preserves watchlist (backend sync)
    - Chart nav item is no longer disabled
  </verify>
  <done>Left sidebar has navigation items above and watchlist panel below with search, click-to-switch chart, and remove functionality. Symbol switching updates both chart and watchlist highlight. Watchlist persists via backend API.</done>
</task>

</tasks>

<verification>
- Watchlist renders in the left sidebar with symbol names, prices, and % change
- Symbol search filters available crypto symbols and shows results
- Adding a symbol via search persists to backend and appears in watchlist
- Clicking a watchlist item switches the chart to that symbol
- Active symbol highlighted in the watchlist
- Removing a symbol via X button removes from backend and UI
- Watchlist survives page refresh (backend persistence)
- Collapsed sidebar hides watchlist
- Default watchlist with BTC, ETH, SOL, BNB auto-created for new users
</verification>

<success_criteria>
- Users can discover symbols via search, add them to a persistent watchlist, and switch between them to view different charts
- The watchlist UI is compact and shows essential info: symbol, price, 24h change
- Chart and watchlist stay in sync: clicking a symbol updates both
- Watchlist data persists across sessions via the backend API
</success_criteria>

<output>
After completion, create `.planning/phases/02-charting-core/02-05-SUMMARY.md`
</output>
