---
phase: 02-charting-core
plan: 03
type: execute
wave: 3
depends_on: [02-01, 02-02]
files_modified:
  - frontend/src/components/chart/chart-toolbar.tsx
  - frontend/src/components/chart/chart-tools-sidebar.tsx
  - frontend/src/components/chart/chart-container.tsx
  - frontend/src/app/(dashboard)/layout.tsx
autonomous: true
requirements: [CHART-02, CHART-05, CHART-06]

must_haves:
  truths:
    - "User can switch between timeframes via compact dropdown and pinned favorite quick-access buttons"
    - "User can switch between chart types (candlestick, heikin-ashi, OHLC bar, line, area) via icon dropdown"
    - "User can toggle between linear and logarithmic price scale"
    - "Left sidebar shows basic tools: crosshair toggle, zoom controls, measurement tool"
    - "Switching timeframe regenerates mock data and re-renders chart"
    - "Switching chart type changes rendering without regenerating data"
  artifacts:
    - path: "frontend/src/components/chart/chart-toolbar.tsx"
      provides: "Top toolbar with timeframe switcher, chart type toggle, scale toggle"
      min_lines: 100
    - path: "frontend/src/components/chart/chart-tools-sidebar.tsx"
      provides: "Left sidebar tools: crosshair toggle, zoom controls, measurement"
      min_lines: 60
  key_links:
    - from: "frontend/src/components/chart/chart-toolbar.tsx"
      to: "frontend/src/stores/chart-store.ts"
      via: "calls setTimeframe, setChartType, toggleScaleMode"
      pattern: "useChartStore"
    - from: "frontend/src/components/chart/chart-toolbar.tsx"
      to: "frontend/src/types/chart.ts"
      via: "imports TIMEFRAMES, ChartType constants"
      pattern: "import.*from.*types/chart"
    - from: "frontend/src/components/chart/chart-container.tsx"
      to: "frontend/src/components/chart/chart-toolbar.tsx"
      via: "renders ChartToolbar above the chart canvas"
      pattern: "ChartToolbar"
---

<objective>
Build the chart top toolbar (timeframe switcher, chart type toggle, scale toggle) and left sidebar tools (crosshair toggle, zoom controls, measurement tool). Integrate both into the chart layout.

Purpose: Users need controls to switch timeframes, change chart types, and toggle price scales -- the core chart interaction controls. The left sidebar prepares the tool panel that Phase 4 will extend with drawing tools.

Output: Functional top toolbar above the chart with all controls working, left sidebar tools panel with basic tools.
</objective>

<execution_context>
@/Users/heispv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/heispv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-charting-core/02-RESEARCH.md
@.planning/phases/02-charting-core/02-CONTEXT.md
@.planning/phases/02-charting-core/02-01-SUMMARY.md
@.planning/phases/02-charting-core/02-02-SUMMARY.md
@frontend/src/components/chart/chart-container.tsx
@frontend/src/app/(dashboard)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build chart top toolbar with timeframe switcher, chart type toggle, and scale toggle</name>
  <files>
    frontend/src/components/chart/chart-toolbar.tsx
  </files>
  <action>
1. Create `frontend/src/components/chart/chart-toolbar.tsx` (`"use client"`):
   - A horizontal toolbar bar rendered above the chart canvas
   - Background: #1e222d (slightly lighter than chart's #131722 for visual separation)
   - Height: ~36-40px, border-bottom 1px #2a2e39
   - Layout: flex row with gap, items vertically centered, padding horizontal 8px

   **Timeframe Switcher (left section):**
   - Read `activeTimeframe`, `favoriteTimeframes`, `setTimeframe`, `toggleFavoriteTimeframe` from chart store
   - Import TIMEFRAMES from types/chart.ts
   - Render favorite timeframes as quick-access buttons (small, compact, ~28px height)
     - Each button shows the timeframe label (e.g., "1H", "4H", "1D")
     - Active timeframe highlighted with brand/accent color background
     - Non-active favorites: subtle background on hover
   - After favorites, render a compact dropdown (Radix DropdownMenu) with ALL timeframes
     - Dropdown trigger: small "..." or down-chevron icon button
     - Each dropdown item shows timeframe label
     - Active timeframe has a checkmark
     - Right-click on a timeframe item in dropdown â†’ toggle favorite (add/remove from pinned)
     - Or: add a star icon next to each item that toggles favorite status
   - Clicking any timeframe (button or dropdown item) calls `setTimeframe(tf)`

   **Chart Type Switcher (middle-left section):**
   - Read `chartType`, `setChartType` from chart store
   - Small icon button showing current chart type icon:
     - candlestick: CandlestickChart icon (lucide-react)
     - heikin-ashi: CandlestickChart icon (same visual, different label)
     - ohlc: BarChart3 icon
     - line: LineChart icon
     - area: AreaChart icon (or TrendingUp)
   - Click opens Radix DropdownMenu with all 5 chart types
   - Each item: icon + label text (e.g., "Candlestick", "Heikin-Ashi", "OHLC Bar", "Line", "Area")
   - Active type has checkmark or highlight
   - Clicking an item calls `setChartType(type)`

   **Scale Toggle (middle-right section):**
   - Read `scaleMode`, `toggleScaleMode` from chart store
   - Small button showing current scale: "Lin" or "Log" text (or use a scale icon)
   - Click toggles between linear and logarithmic
   - Active state: when logarithmic, button appears "pressed" or has accent highlight

   **Symbol display (far left, before timeframe):**
   - Show the active symbol name (e.g., "BTCUSDT") in bold text
   - This is read-only display for now -- symbol switching comes in Plan 05

   All buttons should use consistent styling: small (h-7), rounded, ghost variant on hover, matching the #1e222d toolbar background.
  </action>
  <verify>
    - `npx tsc --noEmit --project frontend/tsconfig.json` passes
    - ChartToolbar component renders with all controls visible
    - Clicking a timeframe button changes chart data
    - Clicking chart type dropdown shows all 5 types with icons
    - Scale toggle switches between Lin/Log labels
    - Radix dropdowns open/close correctly, keyboard navigable
  </verify>
  <done>Top toolbar shows symbol name, favorite timeframe buttons, timeframe dropdown, chart type icon dropdown, and scale toggle -- all wired to chart store actions</done>
</task>

<task type="auto">
  <name>Task 2: Build left sidebar tools panel and integrate toolbar + sidebar into chart layout</name>
  <files>
    frontend/src/components/chart/chart-tools-sidebar.tsx
    frontend/src/components/chart/chart-container.tsx
    frontend/src/app/(dashboard)/layout.tsx
  </files>
  <action>
1. Create `frontend/src/components/chart/chart-tools-sidebar.tsx` (`"use client"`):
   - Narrow vertical toolbar (40-48px wide) positioned to the left of the chart canvas
   - Background: #1e222d, border-right 1px #2a2e39
   - Contains icon-only tool buttons stacked vertically with tooltips:

   **Crosshair Toggle:**
   - Icon: Crosshair (lucide-react)
   - Toggles crosshair mode on the chart between CrosshairMode.Normal (free) and CrosshairMode.Hidden (no crosshair)
   - Default: Normal (on)
   - Active state: highlighted icon
   - Needs access to chart API -- accept an `onToggleCrosshair` callback or use a local state + ref pattern

   **Zoom Controls:**
   - Zoom In icon: ZoomIn (lucide-react) -- calls `chart.timeScale().setVisibleLogicalRange()` to zoom in by reducing visible range by 20%
   - Zoom Out icon: ZoomOut (lucide-react) -- expands visible range by 20%
   - Reset Zoom icon: Maximize2 or RotateCcw -- calls `chart.timeScale().fitContent()` to fit all data
   - Accept callbacks: `onZoomIn`, `onZoomOut`, `onResetZoom`

   **Measurement Tool:**
   - Icon: Ruler (lucide-react)
   - When activated, user clicks point A on chart, then point B
   - Shows an overlay between the two points displaying:
     - Price difference (absolute and percentage)
     - Time/bar difference
   - Implementation: toggle measurement mode, add click handlers to chart container
   - Use chart coordinate conversion: chart.timeScale().coordinateToTime() and chart.priceScale('right').coordinateToPrice() (or series.coordinateToPrice())
   - Render the measurement overlay as an HTML div positioned between the two clicked coordinates
   - Click again or press Escape to clear measurement
   - This is the most complex tool -- keep implementation functional but simple

   Each button: 32x32px, rounded, ghost style, tooltip on hover showing tool name (use Radix Tooltip or title attribute).

2. Update `frontend/src/components/chart/chart-container.tsx`:
   - Add `<ChartToolbar />` above the chart canvas div
   - Add `<ChartToolsSidebar />` to the left of the chart canvas div
   - Layout structure becomes:
     ```
     <div className="flex flex-col h-full w-full">
       <ChartToolbar />
       <div className="flex flex-1 min-h-0">
         <ChartToolsSidebar onZoomIn={...} onZoomOut={...} onResetZoom={...} onToggleCrosshair={...} />
         <div className="flex-1 relative" ref={containerRef}>
           {/* chart canvas + OHLC legend */}
         </div>
       </div>
     </div>
     ```
   - Wire zoom callbacks to chart API:
     - `onZoomIn`: get visible logical range, shrink by 20%, set new range
     - `onZoomOut`: get visible logical range, expand by 20%, set new range
     - `onResetZoom`: `chart.timeScale().fitContent()`
     - `onToggleCrosshair`: toggle crosshair mode option on chart
   - Wire measurement tool state to chart container (click handlers, overlay rendering)

3. Verify `frontend/src/app/(dashboard)/layout.tsx` still works:
   - The chart fills the main content panel. No changes needed to layout.tsx unless the chart-tools-sidebar needs special handling.
   - The left tools sidebar is INSIDE the chart component (not the app's left sidebar panel). It's part of the chart area, next to the canvas.
  </action>
  <verify>
    - `npx tsc --noEmit --project frontend/tsconfig.json` passes
    - Navigate to dashboard: chart has toolbar above and tools sidebar to the left
    - Timeframe buttons switch data correctly
    - Chart type dropdown switches between all 5 types
    - Scale toggle switches between linear and logarithmic
    - Zoom in/out/reset buttons affect chart zoom level
    - Crosshair toggle hides/shows crosshair lines
    - Measurement tool: activate, click two points, see price/time difference overlay
    - All interactions work within the three-panel resizable layout
  </verify>
  <done>Chart has a complete dual-toolbar layout: top bar with timeframe/chart-type/scale controls, left sidebar with crosshair/zoom/measurement tools, all integrated into the chart container within the three-panel dashboard layout</done>
</task>

</tasks>

<verification>
- Top toolbar visible above chart with: symbol name, favorite timeframe buttons, timeframe dropdown, chart type icon dropdown, scale toggle
- Left tools sidebar visible beside chart with: crosshair toggle, zoom in/out/reset, measurement tool
- Switching timeframes regenerates chart data and re-renders
- Switching chart types changes rendering style without losing data
- Scale toggle correctly switches between linear and logarithmic display
- Zoom buttons work alongside scroll wheel zoom
- Crosshair can be toggled on/off
- Measurement tool shows price/time difference between two clicked points
- Favorite timeframes persist across page refreshes (chart store localStorage)
</verification>

<success_criteria>
- All chart controls are functional and visually consistent with TradingView aesthetic
- Timeframe switcher has both pinned favorites and full dropdown
- Chart type switcher shows icons and allows switching between all 5 types
- Left sidebar tools are ready for Phase 4 drawing tool additions
- Controls properly update chart state via Zustand store
</success_criteria>

<output>
After completion, create `.planning/phases/02-charting-core/02-03-SUMMARY.md`
</output>
