---
phase: 02-charting-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/chart.ts
  - frontend/src/lib/mock-data.ts
  - frontend/src/lib/heikin-ashi.ts
  - frontend/src/lib/chart-config.ts
  - frontend/src/stores/chart-store.ts
autonomous: true
requirements: [CHART-01, CHART-02, CHART-08]
# Note: CHART-07 (real-time WebSocket streaming) is Phase 3. Phase 2 satisfies the
# requirement architecturally — series.update() calls will slot in at Phase 3 boundaries —
# but no live data feed is implemented here per the Phase 2 boundary decision in CONTEXT.md.

must_haves:
  truths:
    - "Chart settings (symbol, timeframe, chart type) persist across page refreshes because chart-store writes to localStorage"
    - "Mock data produces visually consistent charts that do not change between page loads for the same symbol/timeframe (deterministic seed)"
    - "Heikin-Ashi mode shows visually smoother candles than standard candlestick mode because the HA transform averages O/H/L/C"
    - "Selecting any of the 10 supported crypto symbols produces a chart — no symbol silently falls back to empty data"
  artifacts:
    - path: "frontend/src/types/chart.ts"
      provides: "Shared chart type definitions (OHLCVData, ChartType, Timeframe, Symbol, etc.)"
      min_lines: 40
    - path: "frontend/src/lib/mock-data.ts"
      provides: "Deterministic OHLCV mock data generator with seeded random"
      min_lines: 80
    - path: "frontend/src/lib/heikin-ashi.ts"
      provides: "Pure function transforming standard OHLC to Heikin-Ashi OHLC"
      min_lines: 25
    - path: "frontend/src/lib/chart-config.ts"
      provides: "Default chart options, series options, TradingView dark theme config"
      min_lines: 50
    - path: "frontend/src/stores/chart-store.ts"
      provides: "Zustand store for chart state (symbol, timeframe, chartType, scaleMode)"
      min_lines: 40
  key_links:
    - from: "frontend/src/lib/mock-data.ts"
      to: "frontend/src/types/chart.ts"
      via: "imports OHLCVData type"
      pattern: "import.*OHLCVData.*from.*types/chart"
    - from: "frontend/src/lib/heikin-ashi.ts"
      to: "frontend/src/types/chart.ts"
      via: "imports OHLCData type"
      pattern: "import.*from.*types/chart"
    - from: "frontend/src/stores/chart-store.ts"
      to: "frontend/src/types/chart.ts"
      via: "imports ChartType, Timeframe"
      pattern: "import.*from.*types/chart"
---

<objective>
Build the chart foundation layer: type definitions, mock OHLCV data generator, Heikin-Ashi data transform, chart visual configuration, and Zustand chart state store. Install lightweight-charts.

Purpose: Everything in Phase 2 depends on these foundational types, data generators, and state management. The chart components (Plan 02), toolbar (Plan 03), and symbol switching (Plan 05) all import from these files. Getting the data layer right first prevents cascading issues.

Output: 5 new frontend files + lightweight-charts installed. No visual output yet -- this is the data/state foundation.
</objective>

<execution_context>
@/Users/heispv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/heispv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-charting-core/02-RESEARCH.md
@.planning/phases/02-charting-core/02-CONTEXT.md
@frontend/src/stores/ui-store.ts
@frontend/src/stores/user-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install lightweight-charts and create chart type definitions</name>
  <files>
    frontend/package.json
    frontend/src/types/chart.ts
  </files>
  <action>
1. Install lightweight-charts:
   ```bash
   cd frontend && npm install lightweight-charts@5.1.0
   ```

2. Create `frontend/src/types/chart.ts` with all shared chart type definitions:

   - `OHLCData` interface: `{ time: string | number; open: number; high: number; low: number; close: number }`
   - `OHLCVData` interface: extends OHLCData with `volume: number`
   - `ChartType` type: `'candlestick' | 'heikin-ashi' | 'ohlc' | 'line' | 'area'`
   - `Timeframe` type: `'1m' | '5m' | '15m' | '30m' | '1H' | '4H' | '1D' | '1W' | '1M'`
   - `ScaleMode` type: `'linear' | 'logarithmic'`
   - `TIMEFRAMES` constant array with label and value for each timeframe (e.g., `{ value: '1m', label: '1m', seconds: 60 }`)
   - `CryptoSymbol` interface: `{ symbol: string; name: string; basePrice: number; volatility: number }` -- basePrice and volatility used by mock data generator
   - `CRYPTO_SYMBOLS` constant array: BTC/USDT (~67000, 0.025), ETH/USDT (~3400, 0.03), SOL/USDT (~175, 0.04), BNB/USDT (~600, 0.025), XRP/USDT (~0.62, 0.035), ADA/USDT (~0.45, 0.04), DOGE/USDT (~0.08, 0.05), AVAX/USDT (~35, 0.04), DOT/USDT (~7.5, 0.035), LINK/USDT (~15, 0.035)
   - `DEFAULT_SYMBOL` constant: first symbol (BTC/USDT)
   - `DEFAULT_TIMEFRAME` constant: `'1D'`
   - `DEFAULT_CHART_TYPE` constant: `'candlestick'`

   Export all types and constants.
  </action>
  <verify>
    - `ls frontend/node_modules/lightweight-charts/package.json` exists
    - `npx tsc --noEmit --project frontend/tsconfig.json` passes (or no new type errors)
    - `frontend/src/types/chart.ts` exports OHLCVData, ChartType, Timeframe, ScaleMode, CRYPTO_SYMBOLS, TIMEFRAMES
  </verify>
  <done>lightweight-charts@5.1.0 installed, all chart types and constants defined and exported with no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Create mock data generator, Heikin-Ashi transform, chart config, and chart store</name>
  <files>
    frontend/src/lib/mock-data.ts
    frontend/src/lib/heikin-ashi.ts
    frontend/src/lib/chart-config.ts
    frontend/src/stores/chart-store.ts
  </files>
  <action>
1. Create `frontend/src/lib/mock-data.ts`:
   - `seededRandom(seed: number): () => number` -- deterministic PRNG using linear congruential generator (s = (s * 1664525 + 1013904223) & 0xFFFFFFFF, return s >>> 0 / 0xFFFFFFFF)
   - `hashString(str: string): number` -- simple hash function to convert symbol+timeframe string to numeric seed
   - `getIntervalSeconds(timeframe: Timeframe): number` -- maps timeframe to seconds (1m=60, 5m=300, ..., 1M=2592000)
   - `getBarCount(timeframe: Timeframe): number` -- returns reasonable bar count per timeframe (1m: 1440 (1 day), 5m: 1440 (5 days), 15m: 1440 (15 days), 30m: 1440 (30 days), 1H: 720 (30 days), 4H: 720 (120 days), 1D: 1000 (~3 years), 1W: 260 (5 years), 1M: 120 (10 years))
   - `generateMockOHLCV(symbol: string, timeframe: Timeframe, basePrice: number, volatility: number): OHLCVData[]` -- produces barCount candles with:
     - Start time calculated backwards from current time
     - Time values as Unix timestamps (number, not string) for lightweight-charts
     - Realistic price walk with slight upward bias for crypto
     - Volume varying randomly between 100k-1M
     - Data sorted ascending by time
   - `getMockDataForSymbol(symbolStr: string, timeframe: Timeframe): OHLCVData[]` -- looks up CryptoSymbol by symbol string and calls generateMockOHLCV with its basePrice/volatility. Falls back to BTC defaults if symbol not found.

2. Create `frontend/src/lib/heikin-ashi.ts`:
   - `toHeikinAshi(data: OHLCData[]): OHLCData[]` -- implements standard HA formula:
     - HA_Close = (O + H + L + C) / 4
     - HA_Open = (prev_HA_Open + prev_HA_Close) / 2 (first bar: HA_Open = O)
     - HA_High = max(H, HA_Open, HA_Close)
     - HA_Low = min(L, HA_Open, HA_Close)
   - Pure function, no side effects. Returns new array.

3. Create `frontend/src/lib/chart-config.ts`:
   - `DEFAULT_CHART_OPTIONS` -- TradingView dark theme per user decisions:
     - Background: #131722 (TradingView default, NOT app's #13131f)
     - Text: #d1d4dc
     - Grid: rgba(42, 46, 57, 0.6) solid lines
     - Crosshair: CrosshairMode.Normal, dashed lines (LineStyle.Dashed), rgba(224, 227, 235, 0.4) color, label background #2a2e39
     - Right price scale: borderVisible false, scaleMargins top 0.1 bottom 0.2
     - Time scale: borderVisible false, timeVisible true, secondsVisible false, rightOffset 5, barSpacing 8
     - Scroll/zoom: mouseWheel true, pressedMouseMove true, pinch true
   - `CANDLESTICK_SERIES_OPTIONS` -- per user decisions:
     - upColor: #26a69a (green), downColor: #ef5350 (red)
     - wickUpColor: #26a69a, wickDownColor: #ef5350
     - borderVisible: false (solid fill, no border = always filled candles)
   - `BAR_SERIES_OPTIONS` -- OHLC bar with same green/red colors
   - `LINE_SERIES_OPTIONS` -- teal line (#26a69a), lineWidth 2
   - `AREA_SERIES_OPTIONS` -- teal top (#26a69a), transparent bottom, fill gradient
   - `VOLUME_SERIES_OPTIONS` -- histogram with priceFormat 'volume', priceScaleId '' (overlay), scaleMargins top 0.8 bottom 0
   - Export a function `getSeriesOptions(chartType: ChartType)` that returns the correct options for each chart type

4. Create `frontend/src/stores/chart-store.ts`:
   - Zustand store with persist middleware (localStorage key: 'chart-store')
   - State:
     - `activeSymbol: string` (default: DEFAULT_SYMBOL.symbol)
     - `activeTimeframe: Timeframe` (default: DEFAULT_TIMEFRAME)
     - `chartType: ChartType` (default: DEFAULT_CHART_TYPE)
     - `scaleMode: ScaleMode` (default: 'linear')
     - `favoriteTimeframes: Timeframe[]` (default: ['1H', '4H', '1D'] -- pinned favorites per user decision)
   - Actions:
     - `setSymbol(symbol: string)` -- updates activeSymbol
     - `setTimeframe(timeframe: Timeframe)` -- updates activeTimeframe
     - `setChartType(chartType: ChartType)` -- updates chartType
     - `toggleScaleMode()` -- toggles between linear/logarithmic
     - `toggleFavoriteTimeframe(tf: Timeframe)` -- adds/removes from favorites
   - Follow the same Zustand pattern as existing ui-store.ts and user-store.ts
  </action>
  <verify>
    - `npx tsc --noEmit --project frontend/tsconfig.json` passes
    - All 4 files exist and export their public APIs
    - Mock data: `getMockDataForSymbol('BTCUSDT', '1D')` should return ~1000 candles with ascending timestamps
    - Heikin-Ashi: `toHeikinAshi([])` returns empty array, `toHeikinAshi([{time:1, open:10, high:15, low:8, close:12}])` returns one HA candle
    - Chart store: `useChartStore.getState()` returns default values
  </verify>
  <done>Mock data generates consistent OHLCV data per symbol+timeframe seed, Heikin-Ashi transform is correct, chart config matches TradingView dark theme with green/red solid candles, chart store persists user's selected symbol/timeframe/chartType/scale to localStorage</done>
</task>

</tasks>

<verification>
- `cd frontend && npm ls lightweight-charts` shows 5.1.0
- All 5 new files exist under frontend/src/
- TypeScript compiles without errors
- No runtime imports of lightweight-charts in these files (types only reference the lib; config uses imports from lightweight-charts for ColorType, LineStyle, etc.)
- Chart store initializes with BTC/USDT, 1D timeframe, candlestick type, linear scale
</verification>

<success_criteria>
- lightweight-charts@5.1.0 is installed and importable
- All chart types (OHLCVData, ChartType, Timeframe, etc.) are defined and exported
- Mock data generator produces deterministic, ascending-time OHLCV arrays
- Heikin-Ashi transform is implemented as a pure function
- Chart configuration constants match TradingView dark theme with user-specified green/red solid candles
- Chart Zustand store persists state to localStorage
</success_criteria>

<output>
After completion, create `.planning/phases/02-charting-core/02-01-SUMMARY.md`
</output>
